const APP={usersKey:'mf_users_v1',sessionKey:'mf_session_v1',initNav(){const nav=document.querySelector('.toplinks');if(!nav)return;const session=this.getSession();nav.innerHTML='';nav.appendChild(this.link('Home','index.html', window.location.pathname.endsWith('index.html')||window.location.pathname.endsWith('/')));nav.appendChild(this.link('About','about.html'));nav.appendChild(this.link('Services','services.html'));nav.appendChild(this.link('Search','search.html'));if(session){nav.appendChild(this.link('Profile','profile.html'));const logout=document.createElement('a');logout.href='#';logout.textContent='Logout';logout.addEventListener('click',(e)=>{e.preventDefault();APP.logout();});nav.appendChild(logout);}else{nav.appendChild(this.link('Register','register.html'));nav.appendChild(this.link('Login','login.html'));}},link(text,href,active=false){const a=document.createElement('a');a.href=href;a.textContent=text;if(active)a.classList.add('active');return a;},getUsers(){return JSON.parse(localStorage.getItem(this.usersKey)||'[]');},saveUsers(users){localStorage.setItem(this.usersKey,JSON.stringify(users));},register(user){const users=this.getUsers();if(users.find(u=>u.email.toLowerCase()===user.email.toLowerCase())){throw new Error('Email already registered');}users.push(user);this.saveUsers(users);this.setSession({email:user.email,name:user.firstName});},login(email,password,remember=false){const users=this.getUsers();const u=users.find(x=>x.email.toLowerCase()===email.toLowerCase()&&x.password===password);if(!u)throw new Error('Invalid credentials');this.setSession({email:u.email,name:u.firstName},remember);},setSession(session,remember=false){if(remember){localStorage.setItem(this.sessionKey,JSON.stringify(session));}else{sessionStorage.setItem(this.sessionKey,JSON.stringify(session));}},getSession(){const s=sessionStorage.getItem(this.sessionKey)||localStorage.getItem(this.sessionKey);return s?JSON.parse(s):null;},logout(){sessionStorage.removeItem(this.sessionKey);localStorage.removeItem(this.sessionKey);this.initNav();window.location.href='index.html';},getUserByEmail(email){return this.getUsers().find(u=>u.email.toLowerCase()===email.toLowerCase());}};document.addEventListener('DOMContentLoaded',()=>{APP.initNav();});